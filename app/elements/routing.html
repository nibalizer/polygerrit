<script src="../bower_components/page/page.js"></script>
<script>
window.addEventListener('WebComponentsReady', function() {
  // Middleware
  function scrollToTop(ctx, next) {
    app.scrollPageToTop();
    next();
  }

  // Routes.
  page('/', function() {
    page.redirect('/q/status:open');
  });

  function queryHandler(data) {
    app.route = 'gr-change-list';
    app.params = data.params;
  }

  page('/q/:query,:offset', scrollToTop, queryHandler);
  page('/q/:query', scrollToTop, queryHandler);

  page('/c/:changeNum', scrollToTop, function(data) {
    app.route = 'gr-change-view';
    app.params = data.params;
  });

  page(/^\/c\/(\d+)\/(\d+)\/(.+)/, scrollToTop, function(ctx) {
    app.route = 'gr-diff';
    var params = {
      changeNum: ctx.params[0],
      patchNum: ctx.params[1],
      path: ctx.params[2]
    };
    app.params = params;
  });

  page.start();
});
</script>
