<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="gr-message">
  <template>
    <style>
      :host {
        border-top: 1px solid #ddd;
        display: block;
        position: relative;
      }
      :host:not([expanded]) {
        cursor: pointer;
      }
      .avatar {
        border-radius: 50%;
      }
      .collapsed .contentContainer {
        padding: 10px;
        padding-right: 55px;
        white-space: nowrap;
        overflow-x: hidden;
        text-overflow: ellipsis;
      }
      .expanded .contentContainer {
        padding: 7px 0 10px;
      }
      .expanded .contentContainer {
        margin-left: 45px;
      }
      .collapsed .contentContainer {
        color: #777;
        margin-left: 35px;
      }
      .avatar {
        position: absolute;
        left: 0;
      }
      .collapsed .avatar {
        top: 8px;
      }
      .expanded .avatar {
        top: 10px;
      }
      .collapsed .avatar {
        height: 25px;
        width: 25px;
      }
      .expanded .avatar {
        height: 35px;
        width: 35px;
      }
      .name {
        font-weight: bold;
      }
      .collapsed .name,
      .collapsed .content {
        display: inline;
      }
      .collapsed .name,
      .collapsed gr-date-formatter {
        color: #000;
      }
      .expanded .name {
        cursor: pointer;
      }
      .expanded .content {
        white-space: pre-wrap;
      }
      gr-date-formatter {
        position: absolute;
        right: 0;
        top: 10px;
      }
    </style>
    <div class$="[[_computeClass(expanded)]]">
      <img class="avatar" src$="[[_computeAvatarURL(message.author)]]">
      <div class="contentContainer">
        <div class="name" id="name">[[message.author.name]]</div>
        <div class="content">[[message.message]]</div>
        <gr-date-formatter date-str="[[message.date]]"></gr-date-formatter>
      </div>
    </div>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'gr-message',

      listeners: {
        'tap': '_tapHandler',
        'name.tap': '_collapseHandler',
      },

      properties: {
        message: Object,
        expanded: {
          type: Boolean,
          value: false,
          reflectToAttribute: true,
        },
      },

      _tapHandler: function(e) {
        if (this.expanded) { return; }
        this.expanded = true;
      },

      _collapseHandler: function(e) {
        if (!this.expanded) { return; }
        e.stopPropagation();
        this.expanded = false;
      },

      _computeClass: function(expanded) {
        return expanded ? 'expanded' : 'collapsed';
      },

      _computeAvatarURL: function(author) {
        return '/accounts/' + author.email + '/avatar?s=100';
      },

    });
  })();
  </script>
</dom-module>
